#!/usr/bin/env bash

function welcome(){
        echo "** ZenySec Exercises **"

        if [[ $EUID -ne 0 ]]; then
                echo "This script must be run as root"
                exit 1
        fi

        if [ -z "$1" ]; then
                echo "usage: ./setup.sh user_name"
		        exit 1
        fi
}

function download_tools(){
        echo "[*] Downloading tools..."
        sshpass -p 'welcome' scp -P20000 -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no welcome@exercises-i386.zenysec.com:/home/welcome/\{debug.sh,gdb_plugin.sh,run.sh,remote.sh\} .
}

function download_challenges(){
        echo "[*] Downloading challenges..."

	for i in ch00 ch01 ch02 ch03 ch04 ch05 ch06 ch07 ch08 ch09 ch10; do
		mkdir -p $i
        	sshpass -p $i scp -P20000 -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no $i@exercises-i386.zenysec.com:/home/$i/\{$i.c,$i,compile.sh\} $i/
	done
}

function download(){
    apt-get update

    download_tools
    download_challenges


}

function change_permissions(){
    chgrp -R $1 ch*/
    chown -R $1 ch*/
    chmod 777 ch*/*

    chgrp -R $1 *.sh
    chown -R $1 *.sh
    chmod +x *.sh
}

function main(){
        welcome $1
        download $1
        change_permissions $1
}

main $1
echo "[*] Done!"
